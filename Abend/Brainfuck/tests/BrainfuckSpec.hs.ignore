module BrainfuckSpec where

import Test.Hspec

import Brainfuck

main :: IO ()
main = hspec spec


spec :: Spec
spec = do
  describe "parsing single commands" $ do
    it "'>' is parsed as TapeRight" $
      parseCommand ">" `shouldBe` Right TapeRight
    it "'<' is parsed as TapeLeft" $
      parseCommand "<" `shouldBe` Right TapeLeft
    it "'+' is parsed as Increment" $
      parseCommand "+" `shouldBe` Right Increment
    it "'-' is parsed as Decrement" $
      parseCommand "-" `shouldBe` Right Decrement
    it "'.' is parsed as PutChar" $
      parseCommand "." `shouldBe` Right PutChar
    it "',' is parsed as GetChar" $
      parseCommand "," `shouldBe` Right GetChar
    it "'[-]' is parsed as Loop [Decrement]" $
      parseCommand "[-]" `shouldBe` Right (Loop [Decrement])
  describe "parsing instructions" $
    it "'>+<' is parsed as [TapeRight, Increment, TapeLeft]" $
      parseInstructions ">[-]<" `shouldBe` Just [TapeRight, Loop [ Decrement ], TapeLeft]


parseCommand :: String -> Either String Instruction
parseCommand = safeHead . parseInstructions
  where safeHead Nothing      = Left "parse error"
        safeHead (Just [])    = Left "did not parse any instructions"
        safeHead (Just (h:_)) = Right h

parseInstructions :: String -> Maybe [Instruction]
parseInstructions = parseBf

